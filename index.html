<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GitteCharity (Nurtura) ‚Äî Empowering Lives, Nurturing Communities</title>
  <meta name="description" content="GitteCharity (Nurtura) is a volunteer-driven initiative helping with education, food, shelter, and animal welfare. Donate, volunteer, give or claim free items." />
  <meta name="theme-color" content="#274c4a" />
  <meta property="og:title" content="GitteCharity (Nurtura)" />
  <meta property="og:description" content="Empowering Lives, Nurturing Communities ‚Äî donate, give, claim free items, and support animals." />
  <style>
    :root{
      --bg:#071022;
      --panel:#0b1022;
      --muted:#94a3b8;
      --text:#e5e7eb;
      --brand:#2c7a7b;       /* teal brand */
      --accent:#68d391;      /* soft green */
      --card: rgba(11,16,34,0.9);
      --shadow: 0 10px 28px rgba(2,6,23,0.6);
      --radius:14px;
      --gap:14px;
    }
    /* Reset & base */
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#020617);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;line-height:1.5;-webkit-font-smoothing:antialiased}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    img{max-width:100%;display:block}
    button{cursor:pointer;border:0}
    .container{max-width:1100px;margin:0 auto;padding:18px}

    /* NAV */
    header.site-nav{position:sticky;top:0;z-index:60;background:linear-gradient(180deg, rgba(6,10,20,0.7), rgba(6,10,20,0.35));backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,0.03)}
    .nav-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 18px}
    .brand{display:flex;gap:12px;align-items:center}
    .brand svg{width:44px;height:44px}
    .brand .title{font-weight:700;font-size:1.05rem}
    .brand .tag{font-size:0.85rem;color:var(--muted)}
    nav.main-links{display:flex;gap:10px;align-items:center}
    nav.main-links a{color:var(--text);padding:8px 10px;border-radius:10px;font-size:0.95rem}
    .nav-actions{display:flex;gap:10px;align-items:center}
    .btn{background:linear-gradient(180deg,var(--brand),#23635f);color:white;padding:8px 12px;border-radius:999px;box-shadow:var(--shadow);font-weight:600}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .menu-toggle{display:none;background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:var(--text)}

    /* HERO */
    .hero{position:relative;min-height:56vh;display:grid;place-items:center;overflow:hidden;padding:28px 0}
    .hero video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.35);pointer-events:none}
    .hero .overlay{position:relative;text-align:center;padding:16px;max-width:980px}
    .pill{display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,0.04);color:var(--muted);border-radius:999px;padding:6px 10px;font-weight:600}
    .hero h1{font-size:clamp(22px,4vw,44px);margin:14px 0 8px}
    .hero p.lead{color:var(--muted);margin-bottom:12px}

    /* SECTIONS */
    section{padding:28px 0;border-top:1px solid rgba(255,255,255,0.02)}
    h2{font-size:clamp(18px,2.6vw,26px);margin:0 0 8px;color:var(--accent)}
    .muted{color:var(--muted)}
    .card{background:var(--card);border-radius:var(--radius);padding:16px;border:1px solid rgba(255,255,255,0.04);box-shadow:var(--shadow)}

    /* GRID helpers */
    .grid{display:grid;gap:var(--gap)}
    .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    .grid.cols-2{grid-template-columns:repeat(2,1fr)}
    .grid.resp{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}

    /* MARKETPLACE / ITEM CARD */
    .toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-bottom:12px}
    .input,.select,textarea{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text);padding:10px 12px;border-radius:10px;outline:none}
    .input::placeholder{color:rgba(229,231,235,0.5)}
    .card.item{display:flex;gap:12px;align-items:flex-start}
    .item img{width:120px;height:100px;border-radius:10px;object-fit:cover;border:1px solid rgba(255,255,255,0.04)}
    .item .meta{flex:1}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,0.03);font-size:13px;color:var(--muted)}

    /* CART panel (desktop: right drawer; mobile: bottom sheet) */
    .cart-toggle{position:fixed;right:18px;bottom:18px;z-index:70}
    .cart-panel{position:fixed;inset:0 0 0 auto;width:min(420px,92vw);background:linear-gradient(180deg,rgba(6,10,20,0.95),rgba(6,10,20,0.98));box-shadow:var(--shadow);transform:translateX(102%);transition:transform .28s;z-index:80;display:flex;flex-direction:column;border-left:1px solid rgba(255,255,255,0.03)}
    .cart-panel.open{transform:translateX(0)}
    .cart-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.03)}
    .cart-body{flex:1;overflow:auto;padding:12px}
    .cart-item{display:flex;gap:12px;border-bottom:1px solid rgba(255,255,255,0.03);padding:10px 0}
    .cart-item img{width:64px;height:64px;border-radius:8px;object-fit:cover}

    /* DONATION Widget (floating) */
    .donate-widget{position:fixed;right:18px;bottom:86px;background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.02));padding:12px;border-radius:12px;box-shadow:var(--shadow);display:none;z-index:75;border:1px solid rgba(255,255,255,0.03)}
    .donate-widget.open{display:block}

    /* Owner dialog (modal) */
    dialog.owner{border:none;border-radius:12px;padding:0;background:transparent}
    .owner-modal{background:var(--card);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);max-width:980px}

    /* FOOTER */
    footer{padding:18px 0;text-align:center;color:var(--muted)}

    /* Responsive adjustments */
    @media (max-width:900px){
      .nav-inner{padding:8px 12px}
      .grid.cols-3{grid-template-columns:1fr 1fr}
      .hero{min-height:48vh}
      .nav-actions{gap:8px}
    }
    @media (max-width:680px){
      nav.main-links{display:none}
      .menu-toggle{display:inline-block}
      .hero h1{font-size:22px}
      .hero .overlay{padding:12px}
      .cart-panel{left:0;right:0;bottom:0;top:auto;height:56vh;width:100%;transform:translateY(102%);border-left:none;border-radius:12px 12px 0 0}
      .cart-panel.open{transform:translateY(0)}
      .cart-header{border-bottom:1px solid rgba(255,255,255,0.03)}
      .item img{width:100%;height:160px;border-radius:10px}
      .card.item{flex-direction:column}
      .container{padding:12px}
    }

    /* small helpers */
    .muted-sm{color:var(--muted);font-size:13px}
    .pill{font-size:13px;display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.03)}
    .small{font-size:13px}
  </style>
</head>
<body>

  <!-- NAV -->
  <header class="site-nav" role="banner">
    <div class="nav-inner container">
      <div class="brand" aria-hidden="false">
        <!-- Inline SVG logo -->
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <circle cx="32" cy="32" r="30" fill="#2c7a7b"/>
          <path d="M32 18c-5 5-8 10-8 14 0 4 3 7 8 7s8-3 8-7c0-4-3-9-8-14z" fill="#68d391"/>
          <path d="M24 40c-3 2-5 4-5 7 0 5 6 9 13 9s13-4 13-9c0-3-2-5-5-7" fill="#edf2f7"/>
        </svg>
        <div>
          <div class="title">GitteCharity</div>
          <div class="tag">Nurtura ¬∑ Empowering Lives</div>
        </div>
      </div>

      <nav class="main-links" aria-label="Main navigation">
        <a href="#home">Home</a>
        <a href="#about">About</a>
        <a href="#market">Free Items</a>
        <a href="#get-involved">Get Involved</a>
        <a href="#animals">Animal Help</a>
        <a href="#contact">Contact</a>
      </nav>

      <div class="nav-actions">
        <button class="menu-toggle" aria-label="Open menu" onclick="toggleMobileMenu()">‚ò∞</button>
        <button class="btn" onclick="openDonate()" aria-label="Donate">Donate</button>
        <button class="btn secondary" onclick="toggleCart()" aria-label="Open cart">Cart üß∫ <span id="cartCount" style="margin-left:8px;background:var(--accent);color:#04241f;padding:2px 8px;border-radius:12px;font-size:13px">0</span></button>
      </div>
    </div>

    <!-- mobile menu (hidden by default) -->
    <div id="mobileMenu" style="display:none;background:linear-gradient(180deg, rgba(6,10,20,0.98), rgba(6,10,20,0.96));padding:10px 18px;border-top:1px solid rgba(255,255,255,0.02)">
      <div style="display:flex;flex-direction:column;gap:8px">
        <a href="#home" onclick="closeMobileMenu()">Home</a>
        <a href="#about" onclick="closeMobileMenu()">About</a>
        <a href="#market" onclick="closeMobileMenu()">Free Items</a>
        <a href="#get-involved" onclick="closeMobileMenu()">Get Involved</a>
        <a href="#animals" onclick="closeMobileMenu()">Animal Help</a>
        <a href="#contact" onclick="closeMobileMenu()">Contact</a>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <main id="home" class="hero" role="main">
    <video autoplay muted loop playsinline poster="" onerror="this.style.display='none'">
      <source src="https://videos.pexels.com/video-files/855293/855293-uhd_2560_1440_30fps.mp4" type="video/mp4" />
    </video>
    <div class="overlay container">
      <div style="display:flex;gap:10px;justify-content:center"><span class="pill">Global Initiatives ‚Ä¢ Reaching lives across India</span></div>
      <h1>Empowering Lives, Nurturing Communities</h1>
      <p class="lead muted">Give or claim essentials for free ‚Äî books, clothes, shoes, school supplies, and more. Delivery charges may apply.</p>
      <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
        <a class="btn" href="#market">Explore Free Items</a>
        <a class="btn secondary" href="#give">List an Item</a>
      </div>
    </div>
  </main>

  <!-- ABOUT -->
  <section id="about">
    <div class="container grid" style="grid-template-columns:1.2fr .8fr;gap:18px">
      <div class="card">
        <h2>About GitteCharity (Nurtura)</h2>
        <p>GitteCharity is a charitable initiative dedicated to <strong>education</strong>, <strong>food</strong>, <strong>shelter</strong>, and <strong>animal welfare</strong>. We connect donors with people who need essentials ‚Äî ensuring dignity through a simple, transparent and community-driven platform.</p>
        <p class="muted">We are building a safe marketplace where anyone can <em>give</em> an item or <em>claim</em> an item for free. Owners may ask claimants to pay delivery charges only. Cash donations help us expand reach.</p>
      </div>

      <aside class="card">
        <h2>Quick Actions</h2>
        <div style="display:flex;flex-direction:column;gap:10px">
          <button class="btn" onclick="openDonate()">Donate via UPI</button>
          <a class="btn secondary" href="#give">List an Item to Give</a>
          <a class="btn ghost" href="#contact">Request Help / Message</a>
          <button class="btn ghost" onclick="openOwner()">Owner / Admin</button>
        </div>
        <p class="muted small" style="margin-top:10px">Tip: this is an open single-file MVP. For multi-user publishing later, connect a backend (Firebase / Supabase).</p>
      </aside>
    </div>
  </section>

  <!-- MARKETPLACE -->
  <section id="market">
    <div class="container">
      <h2>Free Items Marketplace</h2>
      <p class="muted">Claim items for free (pay only delivery if needed). Use filters to find what you need.</p>

      <div class="toolbar" style="margin-top:10px">
        <input id="search" class="input" placeholder="Search items (e.g., books, shoes, laptop)" />
        <select id="category" class="select"><option value="">All categories</option><option>Books</option><option>Clothes</option><option>Shoes</option><option>Electronics</option><option>School Supplies</option><option>Furniture</option><option>Kitchen</option><option>Other</option></select>
        <select id="city" class="select"><option value="">All cities</option><option>Bengaluru</option><option>Mumbai</option><option>Pune</option><option>Hyderabad</option><option>Delhi</option><option>Chennai</option><option>Other</option></select>
        <button class="btn" onclick="applyFilters()">Filter</button>
        <button class="btn ghost" onclick="resetFilters()">Reset</button>
      </div>

      <div id="items" class="grid resp" style="margin-top:14px"></div>

      <!-- GIVE / POST FORM -->
      <div id="give" class="card" style="margin-top:18px">
        <h3>Give an Item</h3>
        <p class="muted">List something in good condition to help someone. Uploaded images are saved locally (to persist across reloads).</p>
        <form id="giveForm" onsubmit="addItem(event)" class="grid" style="grid-template-columns:1fr 1fr;gap:12px;margin-top:10px">
          <input class="input" name="title" required placeholder="Item title (e.g., Class 10 Science Book)" />
          <select class="select" name="category"><option>Books</option><option>Clothes</option><option>Shoes</option><option>Electronics</option><option>School Supplies</option><option>Furniture</option><option>Kitchen</option><option>Other</option></select>
          <input class="input" name="city" required placeholder="City (e.g., Bengaluru)" />
          <input class="input" name="contact" placeholder="Contact (phone/email optional)" />
          <textarea class="input" name="desc" style="grid-column:1/-1" placeholder="Description, condition, pickup/delivery notes"></textarea>

          <!-- file input stored persistently as dataURL -->
          <label class="muted-sm" style="grid-column:1/-1">Photo (JPG/PNG ‚Äî stored locally in browser):</label>
          <input class="input" style="grid-column:1/-1" type="file" accept="image/*" name="photo" />
          <div style="grid-column:1/-1;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <label style="font-size:13px"><input type="checkbox" name="delivery" /> Delivery available (charges may apply)</label>
            <label style="font-size:13px"><input type="checkbox" name="animal" /> Animal-related item</label>
          </div>
          <button class="btn" style="grid-column:1/-1">Post Item</button>
        </form>
        <p class="muted small">Privacy: Images and data are stored in your browser's localStorage. For global listings, we'll connect to a backend later.</p>
      </div>
    </div>
  </section>

  <!-- ANIMAL HELP -->
  <section id="animals">
    <div class="container grid cols-2">
      <div class="card">
        <h2>Animal Help</h2>
        <p class="muted">Report an animal in need or list supplies for shelters. We'll connect volunteers nearby.</p>
        <form id="animalForm" onsubmit="submitAnimal(event)" class="grid" style="grid-template-columns:1fr 1fr;gap:12px;margin-top:10px">
          <input class="input" name="title" required placeholder="e.g., Dog food, Rescue request" />
          <input class="input" name="city" required placeholder="City" />
          <textarea class="input" name="desc" style="grid-column:1/-1" placeholder="Details, location, time"></textarea>
          <input class="input" name="contact" style="grid-column:1/-1" placeholder="Your contact (optional)" />
          <button class="btn" style="grid-column:1/-1">Submit Animal Help</button>
        </form>
      </div>

      <div class="card">
        <h3>Recent Animal Posts</h3>
        <div id="animalList" class="grid" style="margin-top:8px"></div>
      </div>
    </div>
  </section>

  <!-- GET INVOLVED -->
  <section id="get-involved">
    <div class="container grid cols-2">
      <div class="card">
        <h2>Volunteer / Intern</h2>
        <p class="muted">Contribute time or skills‚Äîlogistics, outreach, engineering, animal rescue. Remote and on-ground roles.</p>
        <form id="volForm" onsubmit="submitMessage(event,'volunteers')" class="grid" style="grid-template-columns:1fr 1fr;gap:12px;margin-top:10px">
          <input class="input" name="name" required placeholder="Full Name" />
          <input class="input" name="phone" required placeholder="Phone" />
          <input class="input" name="email" style="grid-column:1/-1" placeholder="Email (optional)" />
          <select class="select" name="role" style="grid-column:1/-1">
            <option>General Volunteer</option>
            <option>Delivery / Pickup</option>
            <option>Campus Ambassador</option>
            <option>Animal Rescue</option>
            <option>Frontend Developer</option>
            <option>Backend Developer</option>
            <option>Designer</option>
          </select>
          <textarea class="input" name="msg" style="grid-column:1/-1" placeholder="Tell us how you'd like to help"></textarea>
          <button class="btn" style="grid-column:1/-1">Submit</button>
        </form>
      </div>

      <div class="card">
        <h2>Contact / Request Help</h2>
        <p class="muted">Ask for books, school supplies, household essentials, or general help. We'll reach out.</p>
        <form id="contactForm" onsubmit="submitMessage(event,'messages')" class="grid" style="grid-template-columns:1fr 1fr;gap:12px;margin-top:10px">
          <input class="input" name="name" required placeholder="Your Name" />
          <input class="input" name="phone" required placeholder="Phone" />
          <textarea class="input" name="msg" style="grid-column:1/-1" placeholder="What do you need? (be specific)"></textarea>
          <button class="btn" style="grid-column:1/-1">Send Message</button>
        </form>
      </div>
    </div>
  </section>

  <!-- CONTACT & INFO -->
  <section id="contact">
    <div class="container grid" style="grid-template-columns:1fr 1fr 1fr;gap:18px">
      <div class="card">
        <h2>Global Initiatives</h2>
        <p class="muted">We aim to reach individuals across India and beyond through partnerships with schools, shelters and NGOs.</p>
        <ul class="muted-sm">
          <li>Learning kits for students</li>
          <li>Community food drives</li>
          <li>Emergency support for families</li>
          <li>Animal rescue & foster network</li>
        </ul>
      </div>
      <div class="card">
        <h2>Official Contact</h2>
        <p>Phone / UPI: <strong>9860191711</strong></p>
        <p>Email: <a href="mailto:pratikgitte20@gmail.com">pratikgitte20@gmail.com</a></p>
        <p class="muted-sm note">Use the contact form for requests so we can track and respond.</p>
      </div>
      <div class="card">
        <h2>Transparency</h2>
        <p class="muted">Open, community-driven and privacy-respecting. This MVP stores data locally in your browser only. For global access, connect a backend later.</p>
        <p class="muted-sm">Admin actions available via Owner / Admin panel (Import / Export / Clear local data).</p>
      </div>
    </div>
  </section>

  <!-- DONATION WIDGET (floating) -->
  <div id="donateWidget" class="donate-widget" role="dialog" aria-modal="true">
    <h3 style="margin:0 0 8px">Donate via UPI</h3>
    <p class="muted-sm">Choose provider and generate UPI QR (amount optional).</p>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
      <select id="upiProvider" class="select" aria-label="UPI provider">
        <option value="@ybl">PhonePe (@ybl)</option>
        <option value="@axl">GPay (@axl)</option>
        <option value="@paytm">Paytm (@paytm)</option>
        <option value="@oksbi">SBI (@oksbi)</option>
        <option value="@okhdfcbank">HDFC (@okhdfcbank)</option>
      </select>
      <input id="upiAmount" class="input" type="number" min="1" placeholder="Amount (‚Çπ)" aria-label="Amount" />
      <input id="upiNote" class="input" style="grid-column:1/-1" placeholder="Note (optional)" aria-label="Note" />
    </div>
    <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
      <button class="btn" onclick="makeUpiQR()">Generate QR</button>
      <button class="btn secondary" onclick="openDonate(false)">Close</button>
    </div>
    <div id="qrWrap" style="margin-top:12px;text-align:center"></div>
    <p class="muted-sm" style="margin-top:8px">If QR doesn't open in your app, send to UPI number <strong>9860191711</strong> manually.</p>
  </div>

  <!-- Floating controls -->
  <button class="btn cart-toggle" style="position:fixed;right:18px;bottom:18px;z-index:65" onclick="toggleCart()">üß∫ Cart <span id="cartCountFloat" style="background:var(--accent);color:#04241f;padding:2px 8px;border-radius:12px;margin-left:8px">0</span></button>
  <button class="btn" style="position:fixed;left:18px;bottom:18px;z-index:65" onclick="openOwner()">üîê Owner</button>

  <!-- CART PANEL -->
  <aside id="cartPanel" class="cart-panel" aria-labelledby="cartTitle" aria-hidden="true">
    <div class="cart-header">
      <strong id="cartTitle">Your Cart (free items)</strong>
      <div><button class="btn ghost" onclick="toggleCart()">Close</button></div>
    </div>
    <div class="cart-body" id="cartItems"></div>
    <div style="padding:12px;border-top:1px solid rgba(255,255,255,0.03)">
      <form id="checkoutForm" onsubmit="checkout(event)" style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <input class="input" name="name" placeholder="Your Name" required />
        <input class="input" name="phone" placeholder="Phone" required />
        <textarea class="input" name="address" style="grid-column:1/-1" placeholder="Address / Pickup preference"></textarea>
        <button class="btn" style="grid-column:1/-1">Request Claim</button>
      </form>
      <p class="muted-sm" style="margin-top:8px">We will connect you with donors. Items are free; delivery charges may apply.</p>
    </div>
  </aside>

  <!-- OWNER / ADMIN DIALOG -->
  <dialog id="ownerDialog" class="owner">
    <div class="owner-modal">
      <form id="ownerLogin" onsubmit="ownerAuth(event)" style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <h3 style="grid-column:1/-1;margin:0">Owner / Admin</h3>
        <input class="input" name="pin" placeholder="Enter PIN (default: 1711)" required />
        <button class="btn" style="grid-column:1/-1">Enter</button>
      </form>

      <div id="ownerPanel" style="display:none;margin-top:12px">
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" onclick="exportData()">Export Data (JSON)</button>
          <label class="btn ghost"><input type="file" accept="application/json" hidden onchange="importData(event)"/> Import</label>
          <button class="btn secondary" onclick="clearAll()">Clear All (local)</button>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-top:12px">
          <div class="card">
            <h4>Items</h4>
            <table class="table" id="ownerItems" style="width:100%;border-collapse:collapse"></table>
          </div>
          <div class="card">
            <h4>Orders / Claims</h4>
            <table class="table" id="ownerOrders" style="width:100%;border-collapse:collapse"></table>
          </div>
          <div class="card">
            <h4>Messages</h4>
            <table class="table" id="ownerMsgs" style="width:100%;border-collapse:collapse"></table>
          </div>
        </div>

        <div style="text-align:right;margin-top:12px">
          <button class="btn ghost" onclick="document.getElementById('ownerDialog').close()">Close</button>
        </div>
      </div>
    </div>
  </dialog>

  <footer>
    <div class="container">
      <div>¬© <span id="year"></span> GitteCharity (Nurtura). All Rights Reserved.</div>
      <div class="muted-sm" style="margin-top:6px">Built with care ‚Ä¢ Single-file MVP ‚Ä¢ <a href="#about">About</a> ‚Ä¢ <a href="#get-involved">Get Involved</a></div>
    </div>
  </footer>

  <!-- SCRIPT: complete functionality (localStorage, items, cart, admin, QR, responsive behaviour) -->
  <script>
    /* ========= local storage helpers ========= */
    const LS_KEYS = {
      ITEMS: 'gc_items_v2',
      CART: 'gc_cart_v2',
      ORDERS: 'gc_orders_v2',
      MSGS: 'gc_messages_v2',
      ANIMALS: 'gc_animals_v2'
    };
    function save(key,val){ localStorage.setItem(key, JSON.stringify(val)); }
    function load(key, fallback){ try { const v = JSON.parse(localStorage.getItem(key)); return v ?? fallback; } catch(e){ return fallback; } }
    function id(){ return Math.random().toString(36).slice(2,10) }
    function toast(msg){ /* simple toast */ alert(msg) }

    /* ======== state ======== */
    const state = {
      items: load(LS_KEYS.ITEMS, []),
      cart: load(LS_KEYS.CART, []),
      orders: load(LS_KEYS.ORDERS, []),
      messages: load(LS_KEYS.MSGS, []),
      animals: load(LS_KEYS.ANIMALS, [])
    };

    /* ======== init samples (first-run) ======== */
    function initSamples(){
      if(state.items.length) return;
      const samples = [
        { title:'Class 10 Science Book (NCERT)', category:'Books', city:'Bengaluru', desc:'Lightly used ‚Äî very good condition.', delivery:true },
        { title:'Winter Jacket ‚Äî Adult M', category:'Clothes', city:'Pune', desc:'Warm, clean.', delivery:false },
        { title:'Sports Shoes ‚Äî size 8', category:'Shoes', city:'Mumbai', desc:'Good grip, lightly used.', delivery:true },
        { title:'Study Table (compact)', category:'Furniture', city:'Delhi', desc:'Wooden, sturdy', delivery:false }
      ];
      state.items = samples.map(s => ({ id:id(), photo:'', contact:'', animal:false, ts:Date.now()-Math.random()*1e7, ...s }));
      save(LS_KEYS.ITEMS, state.items);
    }

    /* ======== render items (marketplace) ======== */
    function placeholder(cat){
      const map = {
        'Books':'https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=800&auto=format&fit=crop',
        'Clothes':'https://images.unsplash.com/photo-1541099649105-f69ad21f3246?q=80&w=800&auto=format&fit=crop',
        'Shoes':'https://images.unsplash.com/photo-1542291026-7eec264c27ff?q=80&w=800&auto=format&fit=crop',
        'Electronics':'https://images.unsplash.com/photo-1518779578993-ec3579fee39f?q=80&w=800&auto=format&fit=crop',
        'School Supplies':'https://images.unsplash.com/photo-1588075592446-265fd1e6e76f?q=80&w=800&auto=format&fit=crop',
        'Furniture':'https://images.unsplash.com/photo-1519710164239-da123dc03ef4?q=80&w=800&auto=format&fit=crop',
        'Kitchen':'https://images.unsplash.com/photo-1488900128323-21503983a07e?q=80&w=800&auto=format&fit=crop',
        'Other':'https://images.unsplash.com/photo-1554412933-514a83d2f3c5?q=80&w=800&auto=format&fit=crop'
      };
      return map[cat] || map['Other'];
    }

    function renderItems(){
      const q = document.getElementById('search').value.trim().toLowerCase();
      const cat = document.getElementById('category').value;
      const city = document.getElementById('city').value.trim().toLowerCase();
      let list = [...state.items].sort((a,b)=>b.ts - a.ts);
      list = list.filter(i => {
        const combined = (i.title + ' ' + (i.desc||'') + ' ' + (i.city||'')).toLowerCase();
        if(q && !combined.includes(q)) return false;
        if(cat && i.category !== cat) return false;
        if(city && i.city.toLowerCase() !== city) return false;
        return true;
      });
      const wrap = document.getElementById('items');
      wrap.innerHTML = '';
      if(list.length === 0){
        wrap.innerHTML = `<div class="card">No items yet. Be the first to <a href="#give">give something</a>!</div>`;
        return;
      }
      list.forEach(i => {
        const el = document.createElement('div');
        el.className = 'card item';
        el.innerHTML = `
          <img src="${i.photo || placeholder(i.category)}" alt="${escapeHtml(i.title)}" />
          <div class="meta">
            <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
              <div style="flex:1">
                <strong>${escapeHtml(i.title)}</strong> <div class="badge">${escapeHtml(i.category)}</div>
                <div class="muted-sm">${escapeHtml(i.city)}${i.delivery? ' ‚Ä¢ Delivery available':''}</div>
              </div>
              <div style="min-width:68px;text-align:right;color:#9ef0c8;font-weight:700">FREE</div>
            </div>
            <div class="muted-sm" style="margin:8px 0">${escapeHtml(i.desc || '')}</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="btn" onclick='addToCart("${i.id}")'>Add to Cart</button>
              <button class="btn secondary" onclick='shareItem("${i.id}")'>Share</button>
              <button class="btn ghost" onclick='contactDonor("${i.id}")'>Contact Donor</button>
            </div>
          </div>`;
        wrap.appendChild(el);
      });
    }

    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])) }

    /* ======== add item (store images as dataURL for persistence) ======== */
    async function readFileAsDataURL(file){
      if(!file) return '';
      return await new Promise((res, rej) => {
        const fr = new FileReader();
        fr.onload = ()=>res(fr.result);
        fr.onerror = rej;
        fr.readAsDataURL(file);
      });
    }

    async function addItem(e){
      e.preventDefault();
      const fd = new FormData(e.target);
      const photoFile = fd.get('photo');
      let dataURL = '';
      if(photoFile && photoFile.size) {
        try { dataURL = await readFileAsDataURL(photoFile) } catch(e){ console.warn('image read failed', e) }
      }
      const item = {
        id: id(),
        title: fd.get('title').trim(),
        category: fd.get('category'),
        city: fd.get('city').trim(),
        contact: fd.get('contact').trim(),
        desc: fd.get('desc').trim(),
        delivery: fd.get('delivery') === 'on',
        animal: fd.get('animal') === 'on',
        photo: dataURL || '',
        ts: Date.now()
      };
      state.items.push(item);
      save(LS_KEYS.ITEMS, state.items);
      e.target.reset();
      renderItems();
      toast('Item posted locally (visible on this device).');
    }

    /* ======== cart logic (add/remove/render/checkout) ======== */
    function addToCart(itemId){
      const item = state.items.find(x=>x.id===itemId);
      if(!item){ toast('Item not found'); return; }
      if(state.cart.find(c=>c.id===item.id)){ toast('Already in cart'); return; }
      state.cart.push({...item, cartTs: Date.now()});
      save(LS_KEYS.CART, state.cart);
      renderCart();
      toggleCart(true);
    }

    function renderCart(){
      const out = state.cart.map(c => `
        <div class="cart-item">
          <img src="${c.photo || placeholder(c.category)}" alt="${escapeHtml(c.title)}" />
          <div style="flex:1">
            <div><strong>${escapeHtml(c.title)}</strong></div>
            <div class="muted-sm">${escapeHtml(c.city)} ‚Ä¢ ${escapeHtml(c.category)}</div>
          </div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button class="btn ghost" onclick='removeFromCart("${c.id}")'>Remove</button>
          </div>
        </div>
      `).join('') || '<div class="muted-sm">Cart is empty</div>';
      document.getElementById('cartItems').innerHTML = out;
      document.getElementById('cartCount').textContent = state.cart.length;
      const float = document.getElementById('cartCountFloat'); if(float) float.textContent = state.cart.length;
      const float2 = document.getElementById('cartCount'); if(float2) float2.textContent = state.cart.length;
    }

    function removeFromCart(id0){
      state.cart = state.cart.filter(x=>x.id !== id0);
      save(LS_KEYS.CART, state.cart);
      renderCart();
    }

    function toggleCart(force){
      const p = document.getElementById('cartPanel');
      const open = (typeof force === 'boolean') ? force : !p.classList.contains('open');
      p.classList.toggle('open', open);
      p.setAttribute('aria-hidden', !open);
      renderCart();
    }

    function checkout(e){
      if(e) e.preventDefault();
      if(state.cart.length === 0){ toast('Cart is empty'); return; }
      // Build WhatsApp message with items
      const lines = state.cart.map(it => `‚Ä¢ ${it.title} (${it.city})`).join('%0A');
      const msg = `Hello GitteCharity, I would like to claim these free items:%0A${lines}%0A%0AName:%0APhone:%0APickup/Delivery preference:%0A`;
      const wa = `https://wa.me/919860191711?text=${msg}`;
      window.open(wa, '_blank');
      // Save order locally
      const order = {
        id: id(),
        name: 'WhatsApp checkout',
        phone: '',
        address: '',
        items: state.cart.map(({id,title,category,city})=>({id,title,category,city})),
        ts: Date.now(),
        status: 'Requested'
      };
      state.orders.push(order);
      save(LS_KEYS.ORDERS, state.orders);
      state.cart = []; save(LS_KEYS.CART, state.cart); renderCart();
      toast('Request sent via WhatsApp. We will connect you.');
    }

    /* ======== contact / messages / volunteers / animals ======== */
    function submitMessage(e, bucket){
      e.preventDefault();
      const fd = new FormData(e.target);
      const rec = Object.fromEntries(fd.entries());
      rec.id = id(); rec.ts = Date.now(); rec.bucket = bucket;
      state.messages.push(rec); save(LS_KEYS.MSGS, state.messages);
      e.target.reset(); toast('Thanks! We will reach out.');
    }

    function submitAnimal(e){
      e.preventDefault();
      const fd = new FormData(e.target);
      const rec = Object.fromEntries(fd.entries());
      rec.id = id(); rec.ts = Date.now();
      state.animals.push(rec); save(LS_KEYS.ANIMALS, state.animals);
      e.target.reset(); renderAnimals(); toast('Animal post recorded (local).');
    }

    function renderAnimals(){
      const wrap = document.getElementById('animalList'); wrap.innerHTML = '';
      state.animals.slice().reverse().forEach(a=>{
        const el = document.createElement('div'); el.className = 'card';
        el.innerHTML = `<strong>${escapeHtml(a.title||a.name||'')}</strong> <div class="muted-sm">${escapeHtml(a.city||'')}</div><div class="muted-sm" style="margin-top:6px">${escapeHtml(a.desc||'')}</div><div class="muted-sm">${escapeHtml(a.contact||'')}</div>`;
        wrap.appendChild(el);
      });
    }

    /* ======== share / contact donor ======== */
    function contactDonor(id0){
      const it = state.items.find(x=>x.id===id0);
      const c = it?.contact?.trim();
      if(!c){ toast('No contact provided by donor. Add to cart and request claim.'); return; }
      if(/@/.test(c)) location.href = `mailto:${c}?subject=About your item: ${encodeURIComponent(it.title)}`;
      else location.href = `tel:${c}`;
    }

    function shareItem(id0){
      const it = state.items.find(x=>x.id===id0);
      const url = location.href.split('#')[0] + '#market';
      const text = `Free on GitteCharity: ${it.title} (${it.city}) ‚Äî ${url}`;
      if(navigator.share){ navigator.share({title:'GitteCharity', text, url}).catch(()=>{}); }
      else { navigator.clipboard?.writeText(text).then(()=>toast('Link copied!')).catch(()=>{}); }
    }

    /* ======== owner / admin (import/export/clear) ======== */
    function openOwner(){ document.getElementById('ownerDialog').showModal(); }
    function ownerAuth(e){
      e.preventDefault();
      const pin = new FormData(e.target).get('pin').trim();
      // default PIN: 1711 (change if you want)
      if(pin !== '1711'){ toast('Wrong PIN'); return; }
      document.getElementById('ownerLogin').style.display = 'none';
      document.getElementById('ownerPanel').style.display = 'block';
      ownerRefresh();
    }

    function ownerRefresh(){
      const itRows = state.items.map(i=>`<tr><td>${escapeHtml(i.title)}</td><td>${escapeHtml(i.city)}</td><td>${escapeHtml(i.category)}</td><td><button class="btn ghost" onclick='delItem("${i.id}")'>Delete</button></td></tr>`).join('') || '<tr><td class="muted-sm">No items</td></tr>';
      document.getElementById('ownerItems').innerHTML = `<tr><th>Title</th><th>City</th><th>Cat</th><th></th></tr>${itRows}`;

      const od = state.orders.map(o=>`<tr><td>${escapeHtml(o.name||'')}</td><td>${escapeHtml(o.phone||'')}</td><td>${o.items.length}</td><td>${new Date(o.ts).toLocaleString()}</td></tr>`).join('') || '<tr><td class="muted-sm">No orders</td></tr>';
      document.getElementById('ownerOrders').innerHTML = `<tr><th>Name</th><th>Phone</th><th>Count</th><th>Time</th></tr>${od}`;

      const ms = state.messages.map(m=>`<tr><td>${escapeHtml(m.bucket||'')}</td><td>${escapeHtml(m.name||'')}</td><td>${escapeHtml(m.phone||'')}</td><td>${escapeHtml((m.msg||m.text||'').slice(0,60))}</td></tr>`).join('') || '<tr><td class="muted-sm">No messages</td></tr>';
      document.getElementById('ownerMsgs').innerHTML = `<tr><th>Type</th><th>Name</th><th>Phone</th><th>Message</th></tr>${ms}`;
    }

    function delItem(id0){ state.items = state.items.filter(i=>i.id !== id0); save(LS_KEYS.ITEMS, state.items); renderItems(); ownerRefresh(); }

    function exportData(){
      const data = { items: state.items, cart: state.cart, orders: state.orders, messages: state.messages, animals: state.animals };
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='gittecharity-data.json'; a.click(); URL.revokeObjectURL(url);
    }

    function importData(e){
      const f = e.target.files[0]; if(!f) return;
      const r = new FileReader(); r.onload = ()=>{
        try{
          const data = JSON.parse(r.result);
          state.items = data.items || state.items; save(LS_KEYS.ITEMS, state.items);
          state.cart = data.cart || state.cart; save(LS_KEYS.CART, state.cart);
          state.orders = data.orders || state.orders; save(LS_KEYS.ORDERS, state.orders);
          state.messages = data.messages || state.messages; save(LS_KEYS.MSGS, state.messages);
          state.animals = data.animals || state.animals; save(LS_KEYS.ANIMALS, state.animals);
          renderItems(); renderCart(); renderAnimals(); ownerRefresh();
          toast('Imported!');
        } catch(err){ toast('Invalid JSON'); }
      }; r.readAsText(f);
    }

    function clearAll(){ if(confirm('Clear all local data?')){ Object.values(LS_KEYS).forEach(k=>localStorage.removeItem(k)); location.reload(); } }

    /* ======== UPI QR generation (dynamic) ======== */
    function openDonate(show=true){ document.getElementById('donateWidget').classList.toggle('open', !!show); }
    function makeUpiQR(){
      const suffix = document.getElementById('upiProvider').value || '@upi';
      const amount = (document.getElementById('upiAmount').value || '').trim();
      const note = (document.getElementById('upiNote').value || 'Donation to GitteCharity');
      const vpa = `9860191711${suffix}`;
      const params = new URLSearchParams({ pa: vpa, pn: 'GitteCharity', tn: note, cu: 'INR' });
      if(amount) params.set('am', amount);
      const uri = `upi://pay?${params.toString()}`;
      const qrApi = `https://api.qrserver.com/v1/create-qr-code/?size=260x260&data=${encodeURIComponent(uri)}`;
      document.getElementById('qrWrap').innerHTML = `<img alt="UPI QR" src="${qrApi}" style="border-radius:10px;border:1px solid rgba(255,255,255,0.04)"/><div class="muted-sm" style="margin-top:8px">VPA: <code style="color:#fff">${vpa}</code></div>`;
    }

    /* ======== Mobile menu helpers ======== */
    function toggleMobileMenu(){ const m = document.getElementById('mobileMenu'); m.style.display = (m.style.display === 'none' || m.style.display === '') ? 'block' : 'none'; }
    function closeMobileMenu(){ document.getElementById('mobileMenu').style.display = 'none'; }

    /* ======== helper boot ======== */
    function renderCart(); // forward declare for linter friendliness
    function renderItems(); // forward declare
    // initialize
    (function init(){
      document.getElementById('year').textContent = new Date().getFullYear();
      initSamples();
      renderItems();
      renderCart = function(){ // define now to ensure DOM exists
        const out = state.cart.map(c => `
          <div class="cart-item">
            <img src="${c.photo || placeholder(c.category)}" alt="${escapeHtml(c.title)}" />
            <div style="flex:1"><div><strong>${escapeHtml(c.title)}</strong></div><div class="muted-sm">${escapeHtml(c.city)} ‚Ä¢ ${escapeHtml(c.category)}</div></div>
            <div style="display:flex;flex-direction:column;gap:8px"><button class="btn ghost" onclick='removeFromCart("${c.id}")'>Remove</button></div>
          </div>`).join('') || '<div class="muted-sm">Cart is empty</div>';
        document.getElementById('cartItems').innerHTML = out;
        document.getElementById('cartCount').textContent = state.cart.length;
        const f = document.getElementById('cartCountFloat'); if(f) f.textContent = state.cart.length;
        const f2 = document.getElementById('cartCount'); if(f2) f2.textContent = state.cart.length;
      };
      renderCart();
      renderAnimals();
      // wire search inputs (debounce light)
      ['search','category','city'].forEach(id=>{
        const el = document.getElementById(id);
        if(el) el.addEventListener('input', () => setTimeout(applyFilters, 120));
      });
      // ensure QR default
      makeUpiQR();
    })();

    /* ======== misc small utils ======== */
    function applyFilters(){ renderItems(); }
    function resetFilters(){ document.getElementById('search').value=''; document.getElementById('category').value=''; document.getElementById('city').value=''; renderItems(); }
    function toggleCart(force){ const p=document.getElementById('cartPanel'); const open = (typeof force === 'boolean') ? force : !p.classList.contains('open'); if(window.matchMedia && window.matchMedia('(max-width:680px)').matches){ p.style.transform = open ? 'translateY(0)' : 'translateY(102%)'; p.classList.toggle('open', open);} else { p.classList.toggle('open', open); } renderCart(); }
  </script>
</body>
</html>
